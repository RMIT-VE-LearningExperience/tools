<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CoVE Canvas Assessment Template Converter</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:#e3e5e0;min-height:100vh;display:flex;flex-direction:column;line-height:1.6}
.main-wrapper{flex:1;padding:20px}
.container{max-width:1600px;margin:0 auto;background:#fff;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.1);overflow:hidden}
.header{background:#000054;color:#fff;padding:30px;text-align:center}
.header h1{font-size:2.5rem;margin-bottom:10px;font-weight:700}
.header p{font-size:1.1rem;opacity:.9}
.workflow-steps{display:flex;justify-content:center;padding:30px;background:#f2f2f2;border-bottom:3px solid #fac800}
.step{display:flex;align-items:center;margin:0 15px;font-weight:600;color:#000054}
.step-number{width:30px;height:30px;background:#000054;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;margin-right:10px;font-size:.9rem}
.step.active .step-number{background:#e61e2a}
.step.completed .step-number{background:#28a745}
.main-layout{display:grid;grid-template-columns:400px 1fr;min-height:70vh}
.sidebar{background:#f2f2f2;padding:30px;border-right:1px solid #e3e5e0}
.content-area{padding:30px}
.upload-area{border:3px dashed #000054;border-radius:8px;padding:40px;text-align:center;transition:all .3s ease;cursor:pointer;background:#fff;margin-bottom:20px}
.upload-area:hover,.upload-area.dragover{border-color:#e61e2a;background:#f8f9fa}
.upload-icon{font-size:3rem;color:#000054;margin-bottom:15px}
.upload-text{font-size:1.1rem;color:#000054;margin-bottom:10px;font-weight:600}
.file-input{display:none}
.extraction-status{display:none;background:#fff;border:2px solid #fac800;border-radius:6px;padding:20px;margin-top:20px}
.extraction-status h3{color:#000054;margin-bottom:15px;font-size:1.2rem}
.status-item{display:flex;align-items:center;margin-bottom:10px;font-size:.95rem}
.status-icon{width:20px;height:20px;border-radius:50%;margin-right:10px;display:flex;align-items:center;justify-content:center;font-size:.8rem;color:#fff;font-weight:700}
.status-icon.found{background:#28a745}
.status-icon.partial{background:#fac800;color:#000054}
.status-icon.missing{background:#e61e2a}
.edit-form{display:none}
.form-section{background:#fff;border:1px solid #e3e5e0;border-radius:6px;padding:25px;margin-bottom:25px}
.form-section h3{color:#000054;margin-bottom:20px;font-size:1.3rem;border-bottom:2px solid #fac800;padding-bottom:10px}
.form-group{margin-bottom:20px}
.form-group label{display:block;font-weight:600;color:#000054;margin-bottom:8px;font-size:.95rem}
.form-group input[type="text"],.form-group textarea,.form-group select{width:100%;padding:10px;border:2px solid #e3e5e0;border-radius:4px;font-size:.95rem;font-family:inherit;transition:border-color .3s;background:#fafbfc}
.form-group input[type="text"]:focus,.form-group textarea:focus,.form-group select:focus{outline:none;border-color:#000054}
.form-group textarea{min-height:100px;resize:vertical}
.rich-editor{width:100%;min-height:150px;padding:10px;border:2px solid #e3e5e0;border-radius:4px;font-size:.95rem;font-family:inherit;transition:border-color .3s;background:#fff;overflow-y:auto;max-height:400px;position:relative}
.rich-editor:focus{outline:none;border-color:#000054}
.rich-editor p{margin-bottom:.5em}
.rich-editor ul,.rich-editor ol{margin-left:20px;margin-bottom:.5em}
.rich-editor li{margin-bottom:.3em}
.editor-toolbar{display:flex;gap:5px;padding:5px;background:#f8f9fa;border:2px solid #e3e5e0;border-bottom:none;border-radius:4px 4px 0 0}
.editor-btn{padding:5px 10px;background:#fff;border:1px solid #ddd;border-radius:3px;cursor:pointer;font-size:14px;transition:all .2s}
.editor-btn:hover{background:#e3e5e0}
.editor-btn.active{background:#000054;color:#fff}
.form-group.large .rich-editor{min-height:200px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:20px}
.help-text{font-size:.85rem;color:#666;margin-top:5px}
.checkbox-group{display:flex;align-items:center;margin:20px 0;padding:15px;background:#f2f2f2;border-radius:4px}
.checkbox-group input[type="checkbox"]{width:20px;height:20px;margin-right:10px;cursor:pointer}
.checkbox-group label{cursor:pointer;font-weight:400}
.button-group{display:flex;gap:15px;margin-top:30px;padding-top:30px;border-top:2px solid #e3e5e0}
.btn{padding:12px 30px;border:none;border-radius:4px;font-size:1rem;font-weight:600;cursor:pointer;transition:all .3s}
.btn-primary{background:#e61e2a;color:#fff}
.btn-primary:hover{background:#c51923;transform:translateY(-1px)}
.btn-secondary{background:#000054;color:#fff}
.btn-secondary:hover{background:#000043;transform:translateY(-1px)}
.btn:disabled{background:#999;cursor:not-allowed;transform:none}
.output-section{display:none}
.output-container{background:#fff;border:2px solid #e3e5e0;border-radius:6px;overflow:hidden;margin-bottom:20px}
.output-header{background:#000054;color:#fff;padding:15px 20px;display:flex;justify-content:space-between;align-items:center}
.output-content{padding:20px;font-family:'Monaco','Menlo',monospace;font-size:.85rem;line-height:1.5;max-height:500px;overflow-y:auto;white-space:pre-wrap;background:#f8f9fa}
.preview-container{background:#fff;border:2px solid #e3e5e0;border-radius:6px;padding:30px;margin-top:20px}
.preview-container h3{color:#000054;margin-bottom:20px}
.alert{padding:15px;border-radius:4px;margin-bottom:20px;display:flex;align-items:center}
.alert-warning{background:#fff9e6;border:1px solid #fac800;color:#856404}
.alert-info{background:#e6f3ff;border:1px solid #0066cc;color:#004085}
.alert-icon{font-size:1.5rem;margin-right:15px}
.loader{display:none;width:40px;height:40px;border:4px solid #f2f2f2;border-top:4px solid #e61e2a;border-radius:50%;animation:spin 1s linear infinite;margin:20px auto}
@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
.footer{background:#000054;color:#fff;text-align:center;padding:20px;margin-top:40px;font-size:.95rem}
.footer a{color:#fac800;text-decoration:none}
.footer a:hover{text-decoration:underline}
.debug-section{background:#f8f9fa;border:1px solid #e3e5e0;border-radius:4px;padding:15px;margin-top:20px;font-family:monospace;font-size:.85rem;max-height:300px;overflow-y:auto;display:none}
.debug-section h4{color:#000054;margin-bottom:10px}
@media(max-width:1200px){.main-layout{grid-template-columns:1fr}.sidebar{border-right:none;border-bottom:1px solid #e3e5e0}}
</style>
</head>
<body>
<div class="main-wrapper">
<div class="container">
<div class="header">
<h1>CoVE Canvas Assessment Template Converter</h1>
<p>Extract, Review &amp; Generate Canvas-Ready HTML</p>
</div>
<div class="workflow-steps">
<div class="step active" id="step1"><div class="step-number">1</div><span>Upload Document</span></div>
<div class="step" id="step2"><div class="step-number">2</div><span>Review &amp; Edit</span></div>
<div class="step" id="step3"><div class="step-number">3</div><span>Generate HTML</span></div>
</div>
<div class="main-layout">
<div class="sidebar">
<div class="upload-area" id="uploadArea">
<div class="upload-icon">üìÑ</div>
<div class="upload-text">Upload Student Version of Assessment Guide</div>
<div class="upload-subtext">Drop .docx file here or click</div>
<input type="file" id="fileInput" class="file-input" accept=".docx">
</div>
<div class="loader" id="loader"></div>
<div class="extraction-status" id="extractionStatus">
<h3>üìä Extraction Results</h3>
<div id="statusList"></div>
</div>
<div class="debug-section" id="debugSection">
<h4>Debug Information</h4>
<pre id="debugContent"></pre>
</div>
</div>
<div class="content-area">
<div id="initialInstructions">
<h2 style="color:#000054;margin-bottom:20px">How to Use This Tool</h2>
<ol style="font-size:1.1rem;line-height:1.8">
<li><strong>Upload</strong> your student version of the Word assessment guide (.docx)</li>
<li><strong>Review</strong> the automatically extracted content</li>
<li><strong>Edit</strong> any fields that need correction with rich text editing</li>
<li><strong>Generate</strong> your Canvas HTML with one click</li>
<li><strong>Upload</strong> the student version of the task and any templates/supporting documents to Canvas and link the buttons to the files so that students can download</li>
</ol>
<div class="alert alert-warning" style="margin-top:30px">
<div class="alert-icon">üí°</div>
<div><strong>Enhanced Extraction:</strong> This tool uses advanced parsing to extract information from RMIT assessment templates, including complex table structures and multiple formatting styles.</div>
</div>
</div>

<div class="edit-form" id="editForm">
<h2 style="color:#000054;margin-bottom:25px">Review &amp; Edit Extracted Content</h2>
<div class="alert alert-info" style="margin-bottom:25px">
<div class="alert-icon">‚ÑπÔ∏è</div>
<div><strong>Note:</strong> We've extracted as much as possible from your document. Please review all fields and make any necessary corrections before generating the HTML.</div>
</div>
<form id="assessmentForm">
<div class="form-section">
<h3>üìã Task &amp; Compliance Information</h3>
<div class="form-row">
<div class="form-group"><label>Task Number</label><input type="text" id="taskNumber" name="taskNumber" placeholder="e.g., 1, 2, 3"></div>
<div class="form-group"><label>Task Name</label><input type="text" id="taskName" name="taskName" placeholder="e.g., Portfolio presentation"></div>
</div>
<div class="form-row">
<div class="form-group"><label>National Unit Code</label><input type="text" id="unitCode" name="unitCode" placeholder="e.g., CUAACD311"><p class="help-text">For multiple codes, separate with spaces</p></div>
<div class="form-group"><label>National Unit Title</label><input type="text" id="unitTitle" name="unitTitle" placeholder="e.g., Produce drawings to communicate ideas"></div>
</div>
<div class="form-row">
<div class="form-group"><label>National Qualification Code</label><input type="text" id="qualificationCode" name="qualificationCode" placeholder="e.g., MSF40122"></div>
<div class="form-group"><label>RMIT Program Code</label><input type="text" id="programCode" name="programCode" placeholder="e.g., C4431"></div>
</div>
<div class="form-group"><label>RMIT Course Code</label><input type="text" id="courseCode" name="courseCode" placeholder="e.g., VART6528C"><p class="help-text">For multiple codes, separate with spaces</p></div>
<div class="form-group"><label>Assessment Type</label>
<select id="assessmentType" name="assessmentType"><option value="document">Document Submission</option><option value="quiz">Quiz</option></select>
<p class="help-text">Select quiz if this is an online test/quiz</p></div>
</div>

<div class="form-section">
<h3>üìù Task Instructions</h3>
<div class="form-group large"><label>Task Instructions</label>
<div class="editor-toolbar">
<button type="button" class="editor-btn" onclick="fmtText('bold')" title="Bold">B</button>
<button type="button" class="editor-btn" onclick="fmtText('italic')" title="Italic">I</button>
<button type="button" class="editor-btn" onclick="fmtText('insertUnorderedList')" title="Bullet List">‚Ä¢ List</button>
<button type="button" class="editor-btn" onclick="fmtText('insertOrderedList')" title="Numbered List">1. List</button>
</div>
<div id="taskInstructions" class="rich-editor" contenteditable="true" data-placeholder="Copy from Summary and Purpose of Assessment"></div>
<p class="help-text">The main instructions for the assessment task</p>
</div>
<div class="checkbox-group"><input type="checkbox" id="includeTemplate" name="includeTemplate"><label for="includeTemplate">Include Student Response Template section</label></div>
</div>

<div class="form-section">
<h3>‚è±Ô∏è Conditions for Assessment</h3>
<div class="form-group large"><label>Assessment Conditions</label>
<div class="editor-toolbar">
<button type="button" class="editor-btn" onclick="fmtText('bold','conditions')" title="Bold">B</button>
<button type="button" class="editor-btn" onclick="fmtText('italic','conditions')" title="Italic">I</button>
<button type="button" class="editor-btn" onclick="fmtText('insertUnorderedList','conditions')" title="Bullet List">‚Ä¢ List</button>
<button type="button" class="editor-btn" onclick="fmtText('insertOrderedList','conditions')" title="Numbered List">1. List</button>
</div>
<div id="conditions" class="rich-editor" contenteditable="true" data-placeholder="Copy from Conditions for assessment section"></div>
</div>
<div class="form-group"><label>Equipment/Resources Students Must Supply</label>
<div class="editor-toolbar">
<button type="button" class="editor-btn" onclick="fmtText('bold','studentSupplies')">B</button>
<button type="button" class="editor-btn" onclick="fmtText('italic','studentSupplies')">I</button>
<button type="button" class="editor-btn" onclick="fmtText('insertUnorderedList','studentSupplies')">‚Ä¢ List</button>
</div>
<div id="studentSupplies" class="rich-editor" contenteditable="true" data-placeholder="‚Ä¢ Item 1"></div>
</div>
<div class="form-group"><label>Equipment/Resources Provided by RMIT</label>
<div class="editor-toolbar">
<button type="button" class="editor-btn" onclick="fmtText('bold','rmitSupplies')">B</button>
<button type="button" class="editor-btn" onclick="fmtText('italic','rmitSupplies')">I</button>
<button type="button" class="editor-btn" onclick="fmtText('insertUnorderedList','rmitSupplies')">‚Ä¢ List</button>
</div>
<div id="rmitSupplies" class="rich-editor" contenteditable="true" data-placeholder="‚Ä¢ Item 1"></div>
</div>
</div>

<div class="form-section">
<h3>üì§ Submission Instructions</h3>
<div class="form-group large"><label>Submission Instructions</label>
<div class="editor-toolbar">
<button type="button" class="editor-btn" onclick="fmtText('bold','submissionInstructions')">B</button>
<button type="button" class="editor-btn" onclick="fmtText('italic','submissionInstructions')">I</button>
<button type="button" class="editor-btn" onclick="fmtText('insertUnorderedList','submissionInstructions')">‚Ä¢ List</button>
<button type="button" class="editor-btn" onclick="fmtText('insertOrderedList','submissionInstructions')">1. List</button>
</div>
<div id="submissionInstructions" class="rich-editor" contenteditable="true" data-placeholder="Copy from Instructions on submitting your task"></div>
</div>
</div>

<div class="form-section">
<h3>ü§ñ AI Acceptable Use</h3>
<div class="checkbox-group"><input type="checkbox" id="includeAI" name="includeAI" onchange="toggleAI()"><label for="includeAI">Add AI - Acceptable use for this assessment</label></div>
<div id="aiOptionsSection" style="display:none">
<div style="background:#f8f9fa;padding:20px;border-radius:4px;margin:20px 0">
<p style="margin-bottom:15px"><strong>AI Acceptable Use Statement Options:</strong></p>
<div style="margin-bottom:15px;padding:10px;background:#fff;border-radius:4px"><p><strong>Option 1: AI tools and their use are not restricted for this assessment task</strong></p><p style="margin-top:5px">In this assessment task, you can use AI tools to assist you. All use of AI tools and their outputs should be appropriately acknowledged and referenced.</p></div>
<div style="margin-bottom:15px;padding:10px;background:#fff;border-radius:4px"><p><strong>Option 2: AI tools are restricted in certain ways for this assessment task</strong></p><p style="margin-top:5px">In this assessment task, you can use AI tools to support you in developing and completing your work by [insert ways] only. Any use of such tools must be appropriately acknowledged and referenced.</p></div>
<div style="margin-bottom:15px;padding:10px;background:#fff;border-radius:4px"><p><strong>Option 3: AI tools are restricted in the completion of this assessment task</strong></p><p style="margin-top:5px">In this assessment task, you can use the following AI tools only [insert names]. Any use of these tools must be appropriately acknowledged and referenced.</p></div>
<div style="margin-bottom:15px;padding:10px;background:#fff;border-radius:4px"><p><strong>Option 4: AI tools cannot be used in the completion of this assessment task</strong></p><p style="margin-top:5px">In this assessment task, you must not use any AI tools (excluding text editing software e.g., Grammarly) to generate any materials, content or ideas related to the task.</p></div>
</div>
<div class="form-group"><label>Select ONE (1) acceptable use statement only:</label>
<select id="aiUseStatement" name="aiUseStatement">
<option value="unrestricted">Option 1: AI tools not restricted</option>
<option value="restricted-ways">Option 2: AI tools restricted in certain ways</option>
<option value="restricted-tools">Option 3: AI tools restricted - specific tools only</option>
<option value="not-permitted">Option 4: AI tools cannot be used</option>
</select></div>
</div>
</div>

<div class="button-group">
<button type="button" class="btn btn-primary" onclick="generateHTML()">Generate Canvas HTML</button>
<button type="button" class="btn btn-secondary" onclick="resetForm()">Start Over</button>
</div>
</form>
</div>

<div class="output-section" id="outputSection">
<h2 style="color:#000054;margin-bottom:25px">Generated Canvas HTML</h2>
<div class="output-container">
<div class="output-header"><span>Canvas HTML Code</span><button class="btn btn-primary" style="padding:8px 20px;font-size:.9rem" onclick="copyHTML()">Copy HTML</button></div>
<div class="output-content" id="outputContent"></div>
</div>
<div class="preview-container"><h3>Preview</h3><div id="previewContent"></div></div>
<div class="button-group">
<button type="button" class="btn btn-secondary" onclick="backToEdit()">Back to Edit</button>
<button type="button" class="btn btn-primary" onclick="resetForm()">New Document</button>
</div>
</div>
</div>
</div>
</div>
</div>
<footer class="footer"><p>Design: Learning &amp; Teaching Innovation Team - RMIT College of Vocational Education</p></footer>

<script>
/* ‚îÄ‚îÄ Helper: pick the best content cell from a table given a header‚Äëmatch cell ‚îÄ‚îÄ */
function bestContentCell(table, row, cell, ri, ci){
  // Strip the header text itself to see if the SAME cell also holds the content
  const selfText = cell.textContent.replace(/Summary\s+and\s+Purpose\s+of\s+Assessment/i,'')
    .replace(/Instructions\s+on\s+Submitting\s+your\s+(?:Product\s+)?(?:Assessment|task)/i,'')
    .replace(/Conditions\s+for\s+assessment/i,'')
    .replace(/Equipment\/resources\s+students\s+must\s+supply[^:]*/i,'')
    .replace(/Equipment\/resources\s+to\s+be\s+provided[^:]*/i,'')
    .trim();

  // Candidate: adjacent cell (ci+1)
  let adj = null, adjLen = 0;
  if(ci+1 < row.cells.length){
    adj = row.cells[ci+1];
    adjLen = adj.textContent.trim().length;
  }
  // Candidate: cell below
  let below = null, belowLen = 0;
  if(ri+1 < table.rows.length){
    const nr = table.rows[ri+1];
    if(nr.cells[ci]){below = nr.cells[ci]; belowLen = below.textContent.trim().length}
  }

  // Pick the candidate with the most content, but only if it beats a 50‚Äëchar threshold
  const candidates = [
    {cell: adj,   len: adjLen},
    {cell: below,  len: belowLen},
    {cell: cell,   len: selfText.length}   // fallback: same cell (content after header)
  ].filter(c => c.cell && c.len > 50);

  candidates.sort((a,b) => b.len - a.len);
  return candidates.length > 0 ? candidates[0].cell : cell;
}

class RMITExtractor{
constructor(){this.debugMode=false}
extract(c){const n=this.norm(c);return{taskNumber:this.exTaskNum(n),taskName:this.exTaskName(n),unitCode:this.exUnitCode(n),unitTitle:this.exUnitTitle(n),qualificationCode:this.exQualCode(n),qualificationTitle:this.exQualTitle(n),programCode:this.exProgCode(n),courseCode:this.exCourseCode(n),taskInstructions:this.exTaskInstr(n),assessmentType:this.detectType(n),includeTemplate:this.detectTpl(n),conditions:this.exConditions(n),studentSupplies:this.exStudentSup(n),rmitSupplies:this.exRMITSup(n),submissionInstructions:this.exSubmission(n)}}
norm(c){return c.replace(/\r\n/g,'\n').replace(/\t/g,' ').replace(/\s{3,}/g,'  ').replace(/\n{3,}/g,'\n\n').replace(/[\u201C\u201D]/g,'"').replace(/[\u2018\u2019]/g,"'").trim()}
exTaskNum(c){const ps=[/Task\s*Number[:\s]*(\d+)\s*(?:of\s*\d+)?/i,/Task\s*Number[^0-9]*(\d+)/i,/Task\s*Number\s*\n+\s*(\d+)/i,/Assessment\s*Task\s*(\d+)/i,/Task\s*(\d+)\s*of\s*\d+/i,/AT\s*(\d+)/i,/(\d+)\s*of\s*\d+\s*Task\s*Name/i];for(const p of ps){const m=c.match(p);if(m&&m[1])return m[1].trim()}return''}
exTaskName(c){const ps=[/Task\s*Name[:\s]*([^\n\r]+?)(?=\n|National|Unit|$)/i,/Task\s*Name[^A-Za-z]*([^\n\r]+)/i,/Task\s*Name\s*\n+\s*([^\n\r]+)/i,/\d+\s*of\s*\d+\s*Task\s*Name\s*([^\n\r]+)/i];for(const p of ps){const m=c.match(p);if(m&&m[1]){const n=m[1].trim();if(n&&!n.match(/^(National|RMIT|Section)/i))return n}}return''}
exUnitCode(c){const r=/National\s*unit[\/\s]*(?:code|s\s*code)/i,m=c.match(r);if(m){const s=m.index+m[0].length,a=c.substring(s,s+200),ps=[/^[:\s]*([A-Z]{2,}[0-9]{3,}[A-Z0-9]*)/i,/([A-Z]{2,}[0-9]{3,}[A-Z0-9]*)/i];for(const p of ps){const mx=a.match(p);if(mx&&mx[1]){const cd=mx[1].toUpperCase().trim();if(cd.match(/^[A-Z]{2,}[0-9]{5}$/))continue;const all=a.match(/[A-Z]{2,}[0-9]{3,}[A-Z0-9]*/gi);if(all&&all.length>0){const uc=all.filter(x=>!x.match(/^[A-Z]{2,}[0-9]{5}$/));if(uc.length>1)return uc.map(x=>x.toUpperCase()).join(' ');if(uc.length===1)return uc[0].toUpperCase()}return cd}}}const sm=c.match(/Unit\s*code[:\s]*/i);if(sm){const s=sm.index+sm[0].length,a=c.substring(s,s+100),cm=a.match(/([A-Z]{2,}[0-9]{3,}[A-Z0-9]*)/i);if(cm&&cm[1]){const cd=cm[1].toUpperCase();if(!cd.match(/^[A-Z]{2,}[0-9]{5}$/))return cd}}return''}
exUnitTitle(c){const ps=[/National\s*unit[/\s]*s?\s*title[:\s]*([^\n\r]+?)(?=National|RMIT|Qualification|$)/i,/National\s*unit[/\s]*s?\s*title[^A-Za-z]*([^\n\r]+)/i,/Unit\s*title[:\s]*([^\n\r]+)/i];for(const p of ps){const m=c.match(p);if(m&&m[1]){let t=m[1].trim().replace(/\s+/g,' ').replace(/[*]+$/,'').trim();if(t&&t.length>5&&!t.match(/^(code|RMIT|National)/i))return t}}return''}
exQualCode(c){const ps=[/National\s*qualification\s*code[:\s]*([A-Z]{2,}[0-9]{4,})/i,/Qualification\s*code[:\s]*([A-Z]{2,}[0-9]{4,})/i,/National\s*qualification\s*code[^A-Z]*([A-Z0-9]+)/i];for(const p of ps){const m=c.match(p);if(m&&m[1])return m[1].trim()}return''}
exQualTitle(c){const ps=[/National\s*qualification\s*title[:\s]*([^\n\r]+?)(?=RMIT|Program|Course|$)/i,/Qualification\s*title[:\s]*([^\n\r]+)/i,/Certificate\s*[IVX]+\s*[^\n\r]+/i];for(const p of ps){const m=c.match(p);if(m){const t=(m[1]||m[0]).trim();if(t&&!t.match(/^(RMIT|code)/i))return t}}return''}
exProgCode(c){const ps=[/RMIT\s*Program\s*code[:\s]*([A-Z0-9]+)/i,/Program\s*code[:\s]*([A-Z][0-9]+)/i,/RMIT\s*Program\s*code[^A-Z]*([A-Z][0-9]+)/i];for(const p of ps){const m=c.match(p);if(m&&m[1])return m[1].trim()}return''}
exCourseCode(c){const ps=[/RMIT\s*Course\s*code[:\s]*([A-Z0-9\s]+?)(?=Section|Assessment|$)/i,/Course\s*code[:\s]*([A-Z]{2,}[0-9]{4,}[A-Z]?(?:\s+[A-Z]{2,}[0-9]{4,}[A-Z]?)*)/i,/RMIT\s*Course\s*code[^A-Z]*([A-Z]{2,}[0-9]{4,}[A-Z]?)/i];for(const p of ps){const m=c.match(p);if(m&&m[1]){const cd=m[1].trim().replace(/\s+/g,' ');if(cd.match(/[A-Z]{2,}[0-9]{4,}/))return cd}}return''}
exTaskInstr(c){const sm=c.match(/Summary\s*and\s*Purpose\s*of\s*Assessment[:\s]*([^]+?)(?=\*\*What\*\*|What\s*\n|\nWhat\s|Upon\s*successful\s*completion|Conditions\s*for|Equipment|Where\s*\n|How\s*\n|Type\s*of\s*Product|$)/i);if(sm&&sm[1]){let i=sm[1].trim().replace(/\*\*/g,'').replace(/Assessment\s*Instructions[:\s]*/i,'').replace(/>\s*/g,'').trim();if(i.length>50)return this.clean(i)}const ta=c.match(/This\s*(?:assessment|project|task|unit)[^.]+\.(?:[^.]+\.){0,10}/i);if(ta){const s=ta[0].split(/(?<=[.!?])\s+/).filter(x=>x.match(/[.!?]$/));if(s.length>0)return this.clean(s.join(' '))}return''}
exConditions(c){const sec=this.exSection(c,[/\*\*Conditions\s+for\s+assessment\*\*/i,/Conditions\s+for\s+assessment/i,/Assessment\s+Conditions/i],[/\*\*Useful\s+Links\*\*/i,/Useful\s+Links/i,/\*\*Equipment\/resources\s+students\s+must\s+supply/i,/Equipment\/resources\s+students\s+must\s+supply/i,/\*\*Instructions\s+on\s+submitting/i,/Instructions\s+on\s+submitting/i,/Section\s+[BC]/i,/Marking\s+Guide/i]);if(sec){const cl=sec.replace(/\*\*/g,''),lines=cl.split('\n').filter(l=>l.trim()),items=[];const ex=[/^Useful\s+Links/i,/Please\s+use\s+the\s+following\s+links/i,/appeal.*assessment.*according.*RMIT\s+Assessment\s+Processes/i,/Find\s+assessments.*course.*submit.*assignments/i,/Information\s+on\s+extensions.*special\s+considerations/i,/disability.*long-term\s+illness.*mental\s+health.*Equitable\s+Assessment/i,/Assessment\s+submission\s+and\s+appeals/i,/recognition\s+of\s+prior\s+learning/i,/recording\s+and\s+retaining\s+assessments/i,/Assessments\./i,/Extensions\s+and\s+special\s+consideration\./i,/Equitable\s+Assessment\s+Arrangements?\./i,/RMIT\s+Assessment\s+Processes/i,/https?:\/\//i,/\[.*\]\(.*\)/,/\.underline/i];const chk=(t)=>{for(const p of ex)if(t.match(p))return true;return false};for(const line of lines){const t=line.trim();if(t.match(/^Conditions\s+for\s+assessment/i))continue;if(chk(t))continue;if(t.match(/^\d+\.\s*(Find|Information|If\s+you\s+have\s+disability)/i))continue;if(t.match(/^[-\u2022\u00B7]\s*/)){const it=t.replace(/^[-\u2022\u00B7]\s*/,'').trim();if(!chk(it)&&it)items.push(it)}else if(t.match(/^\d+[\.\)]\s*/)&&!t.match(/^\d+\.\s*(Find|Information|If\s+you\s+have\s+disability)/i)){const it=t.replace(/^\d+[\.\)]\s*/,'').trim();if(!chk(it)&&it)items.push(it)}else if(t.match(/^(You\s+(must|will|can)|Students\s+(will|must)|Please\s+|If\s+)/i)){if(t.match(/You\s+can\s+appeal/i)||t.match(/If\s+you\s+have\s+disability/i))continue;const sn=t.match(/[^.!?]+[.!?]+/g);if(sn){for(const s of sn){const cs=s.trim();if(!chk(cs)&&cs)items.push(cs)}}else if(t)items.push(t)}else if(t.length>20&&!t.endsWith(':')&&!t.match(/^(Equipment|Instructions|Section)/i)){if(!chk(t))items.push(t)}}const u=[...new Set(items)].filter(i=>i&&i.length>10);if(u.length>0)return u.join('\n')}return''}
exStudentSup(c){const i=c.search(/Equipment\/resources\s+students\s+must\s+supply/i);if(i===-1)return'';const ch=c.substring(i,i+2000),m=ch.match(/Equipment\/resources\s+students\s+must\s+supply[^:]*:\s*([^|]+)\|/i);if(m&&m[1]){const items=[];for(const l of m[1].split('\n')){const t=l.trim();if(!t||t.length<3)continue;let cl=t;if(t.match(/^[-\u00B7\u2022]\s+/))cl=t.replace(/^[-\u00B7\u2022]\s+/,'').trim();if(cl&&!cl.match(/Equipment|resources/i)&&!cl.match(/Onsite|projector|Templates/i))items.push(cl)}return items.join('\n')}return''}
exRMITSup(c){const i=c.search(/Equipment\/resources\s+to\s+be\s+provided\s+by\s+RMIT/i);if(i===-1)return'';const ch=c.substring(i,i+1000),m=ch.match(/Equipment\/resources\s+to\s+be\s+provided\s+by\s+RMIT[^:]*:\s*([^]+?)(?=Section\s+B|Marking\s+Guide|^\s*$)/i);if(m&&m[1]){const items=[];for(const l of m[1].split('\n')){const t=l.trim();if(!t||t.length<3||t==='|')continue;if(t.match(/Section\s+[BC]|Marking/i))break;let cl=t.replace(/^\|+/,'').replace(/\|+$/,'').trim();if(cl.match(/^[-\u00B7\u2022]\s+/))cl=cl.replace(/^[-\u00B7\u2022]\s+/,'').trim();if(cl&&!cl.match(/Equipment|resources/i)&&!cl.match(/Computer\s+and\s+relevant\s+software/i)&&!cl.match(/Online\s+access\s+for\s+research/i))items.push(cl)}return items.join('\n')}return''}
exSubmission(c){const sec=this.exSection(c,[/Instructions\s+on\s+submitting\s+your\s+(?:Product\s+)?(?:Assessment|task)/i,/Submission\s+Instructions/i],[/Equipment\/resources/i,/Useful\s+Links/i,/Section\s+[BC]/i,/Marking\s+Guide/i]);if(sec)return this.clean(sec);const cm=c.match(/[^.]*Canvas[^.]*\./gi);if(cm&&cm.length>0)return cm.map(x=>x.trim()).join(' ');return''}
detectType(c){const l=c.toLowerCase();return['quiz','online test','multiple choice','take the quiz','online quiz','complete the quiz','canvas quiz'].some(k=>l.includes(k))?'quiz':'document'}
detectTpl(c){const l=c.toLowerCase();return['response template','student template','download template','template download'].some(k=>l.includes(k))}
exSection(c,sp,ep,ih=false){let si=-1,mp=null;for(const p of sp){const m=c.match(p);if(m){si=m.index;mp=m[0];break}}if(si===-1)return null;if(!ih&&mp)si+=mp.length;let se=c.length;const sc=c.slice(si);for(const p of ep){const m=sc.match(p);if(m&&m.index!==undefined&&m.index>0)se=Math.min(se,si+m.index)}const sec=c.slice(si,se).trim();if(sec&&sec.length<20){const ee=Math.min(si+1000,c.length),es=c.slice(si,ee),lines=es.split('\n');let found=false,el=[];for(const l of lines){const t=l.trim();if(t&&t.length>5){found=true;el.push(l)}else if(found&&!t)break}if(el.length>0)return el.join('\n').trim()}return sec||null}
clean(t){if(!t)return'';return t.replace(/\*\*/g,'').replace(/^\s*[-\u2022\u00B7]\s*/,'').replace(/\s+/g,' ').replace(/^\d+\.\s*/,'').trim()}
setDebugMode(e){this.debugMode=e}
}

class App{
constructor(){this.uploadArea=document.getElementById('uploadArea');this.fileInput=document.getElementById('fileInput');this.loader=document.getElementById('loader');this.extractionStatus=document.getElementById('extractionStatus');this.statusList=document.getElementById('statusList');this.initialInstructions=document.getElementById('initialInstructions');this.editForm=document.getElementById('editForm');this.outputSection=document.getElementById('outputSection');this.debugSection=document.getElementById('debugSection');this.debugContent=document.getElementById('debugContent');this.extractor=new RMITExtractor();this.extractedData={};this.debugMode=false;this.init()}
init(){this.uploadArea.addEventListener('click',()=>this.fileInput.click());this.fileInput.addEventListener('change',e=>this.handleFile(e.target.files[0]));this.uploadArea.addEventListener('dragover',e=>{e.preventDefault();this.uploadArea.classList.add('dragover')});this.uploadArea.addEventListener('dragleave',()=>this.uploadArea.classList.remove('dragover'));this.uploadArea.addEventListener('drop',e=>{e.preventDefault();this.uploadArea.classList.remove('dragover');this.handleFile(e.dataTransfer.files[0])})}
async handleFile(file){if(!file||!file.name.endsWith('.docx')){alert('Please upload a .docx file');return}if(file.type!=='application/vnd.openxmlformats-officedocument.wordprocessingml.document'){this.loader.style.display='none';alert('Please upload a valid .docx file');return}this.loader.style.display='block';this.updateStep(1,'active');try{const ab=await file.arrayBuffer();let rr,rh;try{rr=await mammoth.extractRawText({arrayBuffer:ab});rh=await mammoth.convertToHtml({arrayBuffer:ab})}catch(e){console.error('Mammoth:',e);this.loader.style.display='none';alert(e.message&&e.message.includes('end of central directory')?'This .docx appears to be password-protected.':'Error processing .docx file.');return}const parser=new DOMParser(),doc=parser.parseFromString(rh.value,"text/html"),tables=doc.querySelectorAll("table");this.extractor.setDebugMode(this.debugMode);this.extractedData=this.extractor.extract(rr.value);

// ‚îÄ‚îÄ Table-based Task Instructions extraction (Summary & Purpose) ‚îÄ‚îÄ
if(tables.length>0){for(const table of tables){for(let ri=0;ri<table.rows.length;ri++){const row=table.rows[ri];for(let ci=0;ci<row.cells.length;ci++){const cell=row.cells[ci];
if(cell.textContent.match(/Summary\s+and\s+Purpose\s+of\s+Assessment/i)){
  // Use helper to find the cell with the most content
  let tc=bestContentCell(table,row,cell,ri,ci);
  const td=document.createElement('div');td.innerHTML=tc.innerHTML;
  const all=Array.from(td.childNodes);let keep=[];let foundSummary=false;let hitStop=false;
  for(const node of all){if(hitStop)break;const txt=node.textContent||'';
    if(!foundSummary){if(txt.match(/Summary\s+and\s+Purpose/i)){foundSummary=true;continue}
      if(node.nodeName==='P'&&txt.trim().length>30){foundSummary=true;keep.push(node)}}
    else{if(txt.match(/^\s*\*?\*?Assessment\s+Instructions/i)||txt.match(/^\s*\*?\*?What\s*\*?\*?\s*$/i)||txt.match(/^\s*This\s+is\s+\*?\*?Observation\s+Task/i)){hitStop=true;continue}
      if(node.nodeName==='P'&&txt.match(/^\s*\*?\*?What\s*\*?\*?/i)){hitStop=true;continue}
      keep.push(node)}}
  if(keep.length>0){const wrap=document.createElement('div');keep.forEach(n=>wrap.appendChild(n.cloneNode(true)));
    wrap.querySelectorAll('*[style]').forEach(e=>e.removeAttribute('style'));
    let html=wrap.innerHTML.replace(/<p>\s*<\/p>/g,'').replace(/<strong>\s*Assessment\s+Instructions\s*<\/strong>/gi,'').trim();
    if(html.length>50)this.extractedData.taskInstructions=html}
  break}}
if(this.extractedData.taskInstructions&&this.extractedData.taskInstructions.startsWith('<'))break}
if(this.extractedData.taskInstructions&&this.extractedData.taskInstructions.startsWith('<'))break}}

// ‚îÄ‚îÄ Table-based Submission Instructions extraction ‚îÄ‚îÄ
if(tables.length>0){for(const table of tables){for(let ri=0;ri<table.rows.length;ri++){const row=table.rows[ri];for(let ci=0;ci<row.cells.length;ci++){const cell=row.cells[ci];
if(cell.textContent.match(/Instructions\s+on\s+Submitting\s+your\s+(?:Product\s+)?(?:Assessment|task)/i)){
  let tc=bestContentCell(table,row,cell,ri,ci);
  // If best cell IS the header cell, strip the header paragraph
  if(tc===cell){const td=document.createElement('div');td.innerHTML=cell.innerHTML;
    const headerP=td.querySelector('p');if(headerP&&headerP.textContent.match(/Instructions\s+on\s+Submitting/i))headerP.remove();
    tc={innerHTML:td.innerHTML}}
  const td=document.createElement('div');td.innerHTML=tc.innerHTML;
  td.querySelectorAll('*[style]').forEach(e=>e.removeAttribute('style'));
  let html=td.innerHTML.replace(/<p>\s*<\/p>/g,'').trim();
  if(html.length>50)this.extractedData.submissionInstructions=html;
  break}}
if(this.extractedData.submissionInstructions&&this.extractedData.submissionInstructions.startsWith('<'))break}
if(this.extractedData.submissionInstructions&&this.extractedData.submissionInstructions.startsWith('<'))break}}

// ‚îÄ‚îÄ Table-based conditions extraction ‚îÄ‚îÄ
if(tables.length>0){for(let ti=0;ti<tables.length;ti++){const table=tables[ti];let cc=null;
for(let ri=0;ri<table.rows.length;ri++){const row=table.rows[ri];for(let ci=0;ci<row.cells.length;ci++){const cell=row.cells[ci];
if(cell.textContent.match(/Conditions\s+for\s+assessment/i)){
  cc=bestContentCell(table,row,cell,ri,ci);break}}
if(cc)break}
if(cc){const td=document.createElement('div');td.innerHTML=cc.innerHTML;
const lis=Array.from(td.querySelectorAll('li')).map(l=>l.textContent.trim()).filter(t=>t);let ct="";
if(lis.length>0){const ex=[/^Useful\s+Links/i,/Please\s+use\s+the\s+following\s+links/i,/appeal.*assessment.*RMIT\s+Assessment\s+Processes/i,/Find\s+assessments.*course/i,/Assessment\s+submission\s+and\s+appeals/i,/Information\s+on\s+extensions/i,/recognition\s+of\s+prior\s+learning/i,/recording\s+and\s+retaining\s+assessments/i,/Equitable\s+Assessment\s+Arrange/i,/disability.*long-term\s+illness.*Equitable\s+Assessment/i,/https?:\/\//i];
ct=lis.filter(i=>{for(const p of ex)if(i.match(p))return false;return true}).join('\n')}
else{const ps=Array.from(td.querySelectorAll('p')).map(p=>p.textContent.trim()).filter(t=>t);
ct=ps.length?ps.join('\n'):cc.textContent.trim()}
if(ct&&ct.length>20){const ls=ct.split('\n').filter(l=>l.trim());
this.extractedData.conditions=ls.map(l=>l.startsWith('-')?l:'- '+l).join('\n')}break}}}

// ‚îÄ‚îÄ Student supplies and RMIT supplies from tables ‚îÄ‚îÄ
if(tables.length>0){let studentCell=null;let rmitCell=null;
for(let ti=0;ti<tables.length;ti++){const table=tables[ti];let found=false;
for(let ri=0;ri<table.rows.length;ri++){const row=table.rows[ri];
for(let ci=0;ci<row.cells.length;ci++){const cell=row.cells[ci];const txt=cell.textContent.trim();
if(txt.match(/Equipment\/resources\s+students\s+must\s+supply/i)){
const stripped=txt.replace(/Equipment\/resources\s+students\s+must\s+supply[^:]*:?\s*/i,'').trim();
if(stripped.length>10){studentCell=cell}
else if(ri+1<table.rows.length&&table.rows[ri+1].cells[ci]){studentCell=table.rows[ri+1].cells[ci]}
if(ci+1<row.cells.length){const adjTxt=row.cells[ci+1].textContent.trim();
if(adjTxt.match(/Equipment\/resources\s+to\s+be\s+provided/i)){
const rmitStripped=adjTxt.replace(/Equipment\/resources\s+to\s+be\s+provided[^:]*:?\s*/i,'').trim();
if(rmitStripped.length>10){rmitCell=row.cells[ci+1]}
else if(ri+1<table.rows.length&&table.rows[ri+1].cells.length>ci+1){rmitCell=table.rows[ri+1].cells[ci+1]}}}
found=true;break}}
if(found)break}
if(found)break}
if(studentCell){try{const td=document.createElement('div');td.innerHTML=studentCell.innerHTML;
Array.from(td.querySelectorAll('p')).forEach(function(p){if(p.textContent.match(/Equipment\/resources\s+students\s+must\s+supply/i))p.remove()});
const lis=Array.from(td.querySelectorAll('li')).map(function(l){return l.textContent.trim()}).filter(function(t){return t});
let sst='';
if(lis.length){sst=lis.join('\n')}
else{const ps=Array.from(td.querySelectorAll('p')).map(function(p){return p.textContent.trim()}).filter(function(t){return t});
if(ps.length){sst=ps.join('\n')}else{sst=td.textContent.replace(/Equipment\/resources\s+students\s+must\s+supply[^:]*:?\s*/i,'').trim()}}
if(sst){this.extractedData.studentSupplies=sst.split('\n').map(function(l){return l.trim()}).filter(function(l){return l&&l.length>2}).map(function(l){return '- '+l}).join('\n')}}catch(e){console.error('Student supplies extraction error:',e)}}
if(rmitCell){try{const td2=document.createElement('div');td2.innerHTML=rmitCell.innerHTML;
Array.from(td2.querySelectorAll('p')).forEach(function(p){if(p.textContent.match(/Equipment\/resources\s+to\s+be\s+provided/i))p.remove()});
const lis2=Array.from(td2.querySelectorAll('li')).map(function(l){return l.textContent.trim()}).filter(function(t){return t});
let rst='';
if(lis2.length){rst=lis2.join('\n')}
else{const ps2=Array.from(td2.querySelectorAll('p')).map(function(p){return p.textContent.trim()}).filter(function(t){return t});
if(ps2.length){rst=ps2.join('\n')}else{rst=td2.textContent.replace(/Equipment\/resources\s+to\s+be\s+provided[^:]*:?\s*/i,'').trim()}}
if(rst){this.extractedData.rmitSupplies=rst.split('\n').map(function(l){return l.trim()}).filter(function(l){return l&&l.length>2}).map(function(l){return '- '+l}).join('\n')}}catch(e){console.error('RMIT supplies extraction error:',e)}}}

this.showStatus();this.populateForm();this.showEdit()}catch(e){console.error(e);alert('Error processing document.')}finally{this.loader.style.display='none'}}
showStatus(){const d=this.extractedData,s=[];s.push({icon:d.taskNumber?'found':'missing',text:'Task Number'+(d.taskNumber?': '+d.taskNumber:'')});s.push({icon:d.taskName?'found':'missing',text:'Task Name'+(d.taskName?': '+d.taskName.substring(0,30)+(d.taskName.length>30?'...':''):'')});s.push({icon:d.taskInstructions?'found':'missing',text:'Task Instructions'+(d.taskInstructions?' ('+d.taskInstructions.split(' ').length+' words)':'')});s.push({icon:d.unitCode?'found':'missing',text:'Unit Code'+(d.unitCode?': '+d.unitCode:'')});s.push({icon:d.conditions?'found':'missing',text:'Assessment Conditions'+(d.conditions?' ('+d.conditions.split('\n').filter(l=>l.trim()).length+' items)':'')});s.push({icon:(d.studentSupplies||d.rmitSupplies)?'found':'missing',text:'Equipment/Resources'+((d.studentSupplies||d.rmitSupplies)?' (Found)':'')});s.push({icon:d.submissionInstructions?'found':'missing',text:'Submission Instructions'+(d.submissionInstructions?' (Found)':'')});this.statusList.innerHTML=s.map(i=>`<div class="status-item"><div class="status-icon ${i.icon}">${i.icon==='found'?'‚úì':i.icon==='partial'?'!':'‚úó'}</div><span>${i.text}</span></div>`).join('');this.extractionStatus.style.display='block'}
populateForm(){const d=this.extractedData,f=document.getElementById('assessmentForm');['taskNumber','taskName','unitCode','unitTitle','qualificationCode','programCode','courseCode'].forEach(k=>{if(f.elements[k]&&d[k])f.elements[k].value=d[k]});['taskInstructions','conditions','studentSupplies','rmitSupplies','submissionInstructions'].forEach(k=>{const el=document.getElementById(k);if(el&&d[k]){let c=d[k];
if(c.trim().startsWith('<')){el.innerHTML=c;return}
if(k==='conditions'||k==='studentSupplies'||k==='rmitSupplies'){const ls=c.split('\n').filter(l=>l.trim());if(ls.length>0){const items=ls.map(l=>l.replace(/^[-\u2022\u00B7]\s*/,'').replace(/^\d+[\.\)]\s*/,'').trim()).filter(i=>i);c='<ul>'+items.map(i=>'<li>'+i+'</li>').join('')+'</ul>'}}else if(c.includes('\n')){const ls=c.split('\n').filter(l=>l.trim());const isBul=ls.some(l=>/^[-\u2022\u00B7]\s*/.test(l)||/^\d+[\.\)]\s*/.test(l)||ls.length>2);if(isBul){const items=ls.map(l=>l.replace(/^[-\u2022\u00B7]\s*/,'').replace(/^\d+[\.\)]\s*/,'').trim()).filter(i=>i);c='<ul>'+items.map(i=>'<li>'+i+'</li>').join('')+'</ul>'}else c=ls.map(l=>'<p>'+l+'</p>').join('')}else if(c.trim()){c=(k==='studentSupplies'||k==='rmitSupplies')?'<ul><li>'+c+'</li></ul>':'<p>'+c+'</p>'}el.innerHTML=c}});if(d.includeTemplate)f.elements.includeTemplate.checked=true;if(d.assessmentType)f.elements.assessmentType.value=d.assessmentType}
showEdit(){this.updateStep(1,'completed');this.updateStep(2,'active');this.initialInstructions.style.display='none';this.editForm.style.display='block';this.outputSection.style.display='none'}
updateStep(n,s){const el=document.getElementById('step'+n);el.classList.remove('active','completed');if(s)el.classList.add(s)}
}

document.querySelectorAll('.rich-editor').forEach(el=>{el.addEventListener('paste',function(e){e.preventDefault();document.execCommand('insertText',false,(e.clipboardData||window.clipboardData).getData('text/plain'))});el.addEventListener('input',function(){if(this.innerHTML==='<br>'||this.innerHTML==='')this.innerHTML=''})});
function fmtText(cmd,id='taskInstructions'){const el=document.getElementById(id);el.focus();if(cmd!=='bold')document.execCommand('removeFormat',false,null);document.execCommand(cmd,false,null)}
function toggleAI(){document.getElementById('aiOptionsSection').style.display=document.getElementById('includeAI').checked?'block':'none'}
function cleanHTML(h){const t=document.createElement('div');t.innerHTML=h;t.querySelectorAll('*[style]').forEach(e=>e.removeAttribute('style'));t.querySelectorAll('p').forEach(p=>{if(p.innerHTML.trim()===''||p.innerHTML==='&nbsp;')p.remove()});return t.innerHTML}

function generateHTML(){const f=document.getElementById('assessmentForm'),d={};['taskNumber','taskName','unitCode','unitTitle','qualificationCode','programCode','courseCode'].forEach(k=>d[k]=f.elements[k].value);['taskInstructions','conditions','studentSupplies','rmitSupplies','submissionInstructions'].forEach(k=>d[k]=cleanHTML(document.getElementById(k).innerHTML));d.includeTemplate=f.elements.includeTemplate.checked;d.assessmentType=f.elements.assessmentType.value;d.includeAI=f.elements.includeAI.checked;d.aiUseStatement=f.elements.aiUseStatement.value;
let h=`<div id="emble-customise-6c7e686a" class="customise emble emble-cblock emble-width-control fullwidth-on emble-cblock-boxshadow white" data-context-menu="customise delete" data-customise="color-block-shadow color-block-theme cblock-fullwidth dsc-cblock-border-colour dsc-cblock-border-style" data-emble-version="2.0">
<div id="emble-customise-38d14b77" class="emble-icon small wrap yellow square emble-prevent-insert emble-prevent-delete-recursive emble-content-editable-false" data-context-menu="customise delete" data-customise="icon-shape icon icon-wrap icon-size icon-colour-options" data-emble-name="Icon" data-icon="icon-circle-arrow-down icon-image icon-courses icon-attach-media icon-video icon-edit icon-document icon-pdf icon-audio icon-arrow-end icon-assignment icon-calendar-month icon-chat icon-group icon-flag" data-emble-version="2.0"><i class="icon-download">&nbsp;</i></div>
<h3><br />Task instructions</h3>
<p>&nbsp;</p>
${d.taskInstructions||'<p><span style="background-color: #fac800;">Copy from Summary and Purpose of Assessment.</span></p>'}
<p>&nbsp;</p>`;
if(d.assessmentType==='quiz'){h+=`<p><strong>What</strong></p>
<p>For this assessment task, you are required to respond to a series of questions. These questions may include short-answer, multiple-choice, matching, and fill-in-the-blank formats, which allow you to demonstrate your skills and knowledge for the unit.</p>
<p>&nbsp;</p>
<p><strong>Where</strong></p>
<p>You will complete this assessment on CANVAS in your own time.</p>
<p>&nbsp;</p>
<p><strong>How</strong></p>
<p>You must answer all questions correctly for you to be assessed as satisfactory for this assessment task.</p>
<p>&nbsp;</p>`}
if(d.assessmentType!=='quiz'){h+=`<p><strong>Download detailed task instructions</strong></p>
<p id="emble-customise-7538f67e" class="btn emble-btn btn-blue customise emble-prevent-delete-recursive" data-context-menu="customise rce-link rce-course-links delete" data-customise="icon button-theme" data-emble-name="Button" data-emble-version="2.0"><i class="icon-circle-arrow-down">&nbsp;</i> <strong>Student Version: AT${d.taskNumber||'[Task Number]'}</strong></p>`}
if(d.includeTemplate&&d.assessmentType!=='quiz'){h+=`
<p><strong>Student Response Template</strong></p>
<p>(Download and complete for final submission by due date)</p>
<p id="emble-customise-5d42da95" class="btn emble-btn btn-blue customise emble-prevent-delete-recursive" data-context-menu="customise rce-link rce-course-links delete" data-customise="icon button-theme" data-emble-name="Button" data-emble-version="2.0"><i class="icon-circle-arrow-down">&nbsp;</i> <strong>Student Response Template: AT${d.taskNumber||'[Task Number]'}</strong></p>`}
h+=`
</div>
<p class="narrow-p">&nbsp;</p>
<div id="emble-customise-ccf6c49e" class="customise emble emble-cblock emble-width-control fullwidth-on white emble-cblock-boxshadow" data-context-menu="customise delete" data-customise="color-block-shadow color-block-theme cblock-fullwidth dsc-cblock-border-colour dsc-cblock-border-style" data-emble-version="2.0">
<div id="emble-customise-fc8de3c6" class="emble-icon small wrap yellow square emble-prevent-insert emble-prevent-delete-recursive emble-content-editable-false" data-context-menu="customise delete" data-customise="icon-shape icon icon-wrap icon-size icon-colour-options" data-emble-name="Icon" data-icon="icon-circle-arrow-down icon-image icon-courses icon-attach-media icon-video icon-edit icon-document icon-pdf icon-audio icon-arrow-end icon-assignment icon-calendar-month icon-chat icon-group icon-flag" data-emble-version="2.0"><i class="icon-hour-glass">&nbsp;</i></div>
<h3><br />Conditions for assessment</h3>
<p>&nbsp;</p>
${d.conditions||'<p><span style="background-color: #fac800;">Copy from Conditions for assessment section.</span></p>'}
<p>&nbsp;</p>
<details>
<summary style="cursor: pointer; font-size: 14pt; color: #222160; font-family: Helvetica, sans-serif; background-color: #f5f5f5; padding: 10px; margin-bottom: 5px;" aria-expanded="false"><span style="font-size: 12pt;">Equipment/resources students must supply</span></summary>
${d.studentSupplies||'<p><span style="background-color: #fac800;">Copy as a bulleted list</span></p>'}
<p>&nbsp;</p>
</details><details>
<summary style="cursor: pointer; font-size: 14pt; color: #222160; font-family: Helvetica, sans-serif; background-color: #f5f5f5; padding: 10px; margin-bottom: 5px;" aria-expanded="false"><span style="font-size: 12pt;">Equipment/resources to be provided by RMIT or the workplace</span></summary>
${d.rmitSupplies||'<p><span style="background-color: #fac800;">Copy as a bulleted list</span></p>'}
<p>&nbsp;</p>
</details></div>
<p class="narrow-p">&nbsp;</p>
<div id="emble-customise-c31a0397" class="customise emble emble-cblock emble-width-control fullwidth-on white emble-cblock-boxshadow" data-context-menu="customise delete" data-customise="color-block-shadow color-block-theme cblock-fullwidth dsc-cblock-border-colour dsc-cblock-border-style" data-emble-version="2.0">
<div id="emble-customise-a356f3e8" class="emble-icon small wrap emble-prevent-insert emble-prevent-delete-recursive emble-content-editable-false square yellow" data-context-menu="customise delete" data-customise="icon-shape icon icon-wrap icon-size icon-colour-options" data-emble-name="Icon" data-icon="icon-circle-arrow-down icon-image icon-courses icon-attach-media icon-video icon-edit icon-document icon-pdf icon-audio icon-arrow-end icon-assignment icon-calendar-month icon-chat icon-group icon-flag" data-emble-version="2.0"><i class="icon-info">&nbsp;</i></div>
<h3><br />Instructions on submitting your assessment</h3>
${d.submissionInstructions?(d.submissionInstructions.trim().startsWith('<')?d.submissionInstructions:'<p>'+d.submissionInstructions+'</p>'):'<p><span style="background-color: #fac800;">Copy from Instructions on submitting your task</span></p>'}`;
if(d.assessmentType==='quiz'){h+=`
<p><strong>Step-by-Step Submission Instructions:</strong></p>
<ol>
<li>Select Take the quiz</li>
<li>Enter answers for each question.</li>
<li>When you have finished, select the Submit quiz button.</li>
<li>Note: Once you select the Submit quiz button you will not be able to make any changes to this attempt.</li>
<li>For questions that require manual grading (e.g. essay type questions), you will have to wait until your assessor marks these.</li>
<li>If required, you must wait until your assignment is graded by your teachers before beginning another attempt.</li>
</ol>`}else{h+=`
<p><strong>Step-by-Step Submission Instructions:</strong></p>
<ol>
<li>Select Start assignment</li>
<li>Select Choose File</li>
<li>Locate and select your final completed assessment file (named as per the naming convention)</li>
<li>Add any comments, if required</li>
<li>Select Submit assignment</li>
</ol>`}
h+=`
<h3>RMIT Electronic Submission of Work For Assessment</h3>
<p>I declare that in submitting all work for this assessment I have read, understood and agree to the content and expectations of the&nbsp;<a class="external" href="https://www.rmit.edu.au/students/student-essentials/assessment-and-exams/assessment/assessment-declaration" target="_blank" rel="noopener">Assessment declaration</a>&nbsp;</p>`;
if(d.includeAI){h+='<h3>AI - Acceptable use for this assessment</h3>';switch(d.aiUseStatement){case'unrestricted':h+='<p><strong>AI tools and their use are not restricted for this assessment task</strong></p><p>In this assessment task, you can use AI tools to assist you. All use of AI tools and their outputs should be appropriately acknowledged and referenced.</p>';break;case'restricted-ways':h+='<p><strong>AI tools are restricted in certain ways for this assessment task</strong></p><p>In this assessment task, you can use AI tools to support you in developing and completing your work by <span style="background-color: #fac800;">[insert ways students are permitted to use AI tools e.g., generating ideas/planning/drafting]</span> only. Any use of such tools must be appropriately acknowledged and referenced.</p>';break;case'restricted-tools':h+='<p><strong>AI tools are restricted in the completion of this assessment task</strong></p><p>In this assessment task, you can use the following AI tools only <span style="background-color: #fac800;">[insert name(s) of tools, or types of tools e.g. image generators/text generators/standard editing software]</span>. Any use of these tools must be appropriately acknowledged and referenced.</p>';break;case'not-permitted':h+='<p><strong>AI tools cannot be used in the completion of this assessment task</strong></p><p>In this assessment task, you must not use any AI tools (excluding text editing software e.g., Grammarly) to generate any materials, content or ideas related to the task.</p>';break}}
h+=`
</div>
<p class="narrow-p">&nbsp;</p>
<div id="emble-customise-9aba4b52" class="customise emble emble-cblock emble-width-control fullwidth-on white emble-cblock-boxshadow" data-context-menu="customise delete" data-customise="color-block-shadow color-block-theme cblock-fullwidth dsc-cblock-border-colour dsc-cblock-border-style" data-emble-version="2.0"><details>
<summary style="cursor: pointer; font-size: 1.4rem; color: #222160; font-family: Helvetica, sans-serif; background-color: #f5f5f5; padding: 10px; margin-bottom: 5px;">Useful Assessment Links&nbsp;</summary>
<p><span>Please use links below to access important information on assessments:</span>&nbsp;</p>
<ul>
<li><span>Assessment submission and appeals - </span><a href="https://www.rmit.edu.au/students/my-course/assessment-results/assessment">Assessments</a>&nbsp;</li>
<li><span>Extensions and special considerations - </span><a href="https://www.rmit.edu.au/students/my-course/assessment-results/special-consideration-extensions/equitable-assessment-arrangements">Extensions and special consideration</a>&nbsp;</li>
<li><span>Equitable Assessment Arrangement (EAA) - </span><a href="https://www.rmit.edu.au/students/support-services/equitable-learning">Equitable Assessment Arrangements</a>&nbsp;</li>
<li><span>Information on recording and retaining assessments and dealing with assessment appeals can be found in the </span><a href="https://policies.rmit.edu.au/download.php?associated=1&amp;id=348&amp;version=1">RMIT Assessment Processes document</a></li>
<li>Information on recognition of prior learning &ndash; <a href="https://www.rmit.edu.au/students/my-course/enrolment/apply-for-credit">RMIT recognition of prior learning (RPL)</a></li>
</ul>
</details></div>
<p class="narrow-p">&nbsp;</p>
<div id="emble-customise-75d98739" class="customise emble-columns-container emble-columns-controller-2 emble-columns-stretch-child-height" data-context-menu="customise delete" data-customise="new-columns-arrangement new-columns-border new-columns-padding columns-stretch-children" data-emble-name="Columns" data-emble-version="2.0">
<div class="emble-columns-child emble-prevent-delete">
<div id="emble-customise-bf5219ac" class="customise emble emble-cblock emble-width-control fullwidth-on emble-cblock-boxshadow white" data-context-menu="customise delete" data-customise="color-block-shadow color-block-theme cblock-fullwidth dsc-cblock-border-colour dsc-cblock-border-style" data-emble-version="2.0">
<div id="emble-customise-be5385dd" class="emble-icon small wrap emble-prevent-insert emble-prevent-delete-recursive emble-content-editable-false yellow square" data-context-menu="customise delete" data-customise="icon-shape icon icon-wrap icon-size icon-colour-options" data-emble-name="Icon" data-icon="icon-circle-arrow-down icon-image icon-courses icon-attach-media icon-video icon-edit icon-document icon-pdf icon-audio icon-arrow-end icon-assignment icon-calendar-month icon-chat icon-group icon-flag" data-emble-version="2.0"><i class="icon-info">&nbsp;</i></div>
<p><span style="font-size: 12pt;"><strong>Task number:</strong> ${d.taskNumber||'<span style="background-color: #fac800;">xxxxx</span>'}</span></p>
<p><span style="font-size: 12pt;"><strong>National unit code:</strong> ${d.unitCode||'<span style="background-color: #fac800;">xxxxx</span>'}</span></p>
<p><span style="font-size: 12pt;"><strong>National qualification code:</strong> ${d.qualificationCode||'<span style="background-color: #fac800;">xxxxx</span>'}</span></p>
<p><span style="font-size: 12pt;"><strong>RMIT program code:</strong>&nbsp; ${d.programCode||'<span style="background-color: #fac800;">xxxxx</span>'}</span></p>
<p><span style="font-size: 12pt;"><strong>Task name:</strong> ${d.taskName||'<span style="background-color: #fac800;">xxxxx</span>'}</span></p>
<p><span style="font-size: 12pt;"><strong>National unit title:</strong> ${d.unitTitle||'<span style="background-color: #fac800;">xxxxx</span>'}</span></p>
<p><span style="font-size: 12pt;"><strong>RMIT course code:</strong> ${d.courseCode||'<span style="background-color: #fac800;">xxxxx</span>'}</span></p>
</div>
<p class="narrow-p">&nbsp;</p>
</div>
<div class="emble-columns-child emble-prevent-delete">
<div id="emble-customise-c3025cb3" class="customise emble emble-cblock emble-width-control fullwidth-on white emble-cblock-boxshadow" data-context-menu="customise delete" data-customise="color-block-shadow color-block-theme cblock-fullwidth dsc-cblock-border-colour dsc-cblock-border-style" data-emble-version="2.0">
<div id="emble-customise-56de29f7" class="emble-icon small wrap emble-prevent-insert emble-prevent-delete-recursive emble-content-editable-false yellow square" data-context-menu="customise delete" data-customise="icon-shape icon icon-wrap icon-size icon-colour-options" data-emble-name="Icon" data-icon="icon-circle-arrow-down icon-image icon-courses icon-attach-media icon-video icon-edit icon-document icon-pdf icon-audio icon-arrow-end icon-assignment icon-calendar-month icon-chat icon-group icon-flag" data-emble-version="2.0"><i class="icon-calendar-month">&nbsp;</i></div>
<p><strong>Duration/and or due date: <span style="background-color: #fac800;">TEACHER TO UPDATE</span> at 11:59pm</strong></p>
<p><span style="font-size: 12pt;"><strong>Feedback and Grades:</strong> Feedback on your assignment and your grade will be released via the Grades. Assessment tasks will receive the following outcomes: Satisfactory or Not Satisfactory.</span></p>
</div>
<p>&nbsp;</p>
</div>
</div>
<p class="narrow-p">&nbsp;</p>`;
document.getElementById('outputContent').textContent=h;document.getElementById('previewContent').innerHTML=h;window.app.updateStep(2,'completed');window.app.updateStep(3,'active');document.getElementById('editForm').style.display='none';document.getElementById('outputSection').style.display='block';window.scrollTo(0,0)}

function copyHTML(){const c=document.getElementById('outputContent').textContent,ta=document.createElement('textarea');ta.value=c;ta.style.position='fixed';ta.style.left='-999999px';document.body.appendChild(ta);ta.focus();ta.select();try{document.execCommand('copy');const b=event.target,o=b.textContent;b.textContent='Copied!';b.style.background='#28a745';setTimeout(()=>{b.textContent=o;b.style.background=''},2000)}catch(e){alert('Please copy manually (Ctrl+C)')}document.body.removeChild(ta)}
function backToEdit(){window.app.updateStep(3,'');window.app.updateStep(2,'active');document.getElementById('editForm').style.display='block';document.getElementById('outputSection').style.display='none'}
function resetForm(){if(confirm('Start over with a new document?'))location.reload()}
window.app=new App();
const st=document.createElement('style');st.textContent=`.rich-editor[data-placeholder]:empty:before{content:attr(data-placeholder);color:#999;position:absolute;pointer-events:none;white-space:pre-line}.rich-editor:focus[data-placeholder]:empty:before{content:attr(data-placeholder);color:#ccc}`;document.head.appendChild(st);
</script>
</body>
</html>